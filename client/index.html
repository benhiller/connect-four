<!DOCTYPE html>
<html>
  <head>
    <title>Connect Four</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="drawing.js"></script>
    <script type="text/javascript" src="../connect-four.js"></script>
    <script type="text/javascript" src="board.js"></script>
    <script>
      var ws = new WebSocket("ws://localhost:8080");
      ws.onopen = function(event) {
        $('#connecting').hide();
      }

      ws.onmessage = function(event) {
        if(event.data.match(/^Game found: [12]$/)) {
          var turn = event.data.indexOf('1') == -1 ? 2 : 1;
          newGame(turn);
        } else if(event.data === "Opponent left") {
          console.log('a');
          gameAbortedByOpponent();
        } else if(event.data.match(/^Move: [0-6]$/)) {
          opponentMoved(parseInt(event.data.match(/[0-6]/)[0]));
        } else if(event.data.match(/^Preview: [0-6]$/)) {
          var col = event.data.match(/[0-6]/)[0];
          draw.drawPiece(col, 0, game.currentPlayer, true);
        } else if(event.data.match(/^Hide preview$/)) {
          draw.clearPreview();
        }
      }

      window.onunload = function() {
        ws.close();
      }
    </script>
  </head>
  <body>
    <!-- Each cell is 50x50 -->
    <!-- 7x6 cells, so width = 7*50 + border, height = 6*50 + border -->
    <canvas id="board" width="350" height="350"></canvas>
    <br/>
    <div id="connecting">Connecting to server</div>
    <div id="waiting">Waiting to find a player</div>
    <div id="left" style="display: none">Opponent left, waiting for a new game</div>
    <div id="win" style="display: none">You win!</div>
    <div id="tie" style="display: none">You tie</div>
    <div id="lose" style="display: none">You lose</div>
  </body>
</html>
