<!DOCTYPE html>
<html>
  <head>
    <title>Connect Four</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="drawing.js"></script>
    <script type="text/javascript" src="../connect-four.js"></script>
    <script type="text/javascript" src="board.js"></script>
    <script>
      var ws;
      $(document).ready(function() {
        if(!("WebSocket" in window)) {
          $('#unsupported').show();
          $('#connecting').hide();
          $('#waiting').hide();
          return;
        }
        ws = new WebSocket("ws://10.0.1.8:8080");
        ws.onopen = function(event) {
          $('#connecting').hide();
          $('#go').show();
        }

        ws.onmessage = function(event) {
          if(event.data.match(/^Game found: [12]$/)) {
            var turn = event.data.indexOf('1') == -1 ? 2 : 1;
            newGame(turn);
          } else if(event.data === "Opponent left") {
            gameAbortedByOpponent();
          } else if(event.data.match(/^Move: [0-6]$/)) {
            opponentMoved(parseInt(event.data.match(/[0-6]/)[0]));
          } else if(event.data.match(/^Preview: [0-6]$/)) {
            var col = event.data.match(/[0-6]/)[0];
            draw.drawPiece(col, game.potentialRow(col), game.currentPlayer, true);
          } else if(event.data.match(/^Hide preview$/)) {
            draw.clearPreview();
          }
        }
      });

      window.onunload = function() {
        ws.close();
      }
    </script>
  </head>
  <body>
    <!-- Each cell is 50x50 -->
    <!-- 7x6 cells, so width = 7*50 + border, height = 6*50 + border -->
    <canvas id="board" width="350" height="350"></canvas>
    <br/>
    <div id="connecting">Connecting to server</div>
    <div id="waiting" style="display: none">Waiting to find a player</div>
    <div id="left" style="display: none">Sorry, your opponent left, I'm sure you would've won.</div>
    <div id="win" style="display: none">You win!</div>
    <div id="tie" style="display: none">You tie</div>
    <div id="lose" style="display: none">You lose</div>
    <div id="theirturn" class="turn" style="display: none">Their turn</div>
    <div id="yourturn" class="turn" style="display: none">Your turn</div>
    <div id="unsupported" style="display: none">Sorry, you need to use a browser which supports WebSockets</div>
    <button id="again" style="display: none">Play again?</button>
    <button id="go" style="display: none">Play a game?</button>
  </body>
</html>
